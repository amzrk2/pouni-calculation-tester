# 四则运算自测系统

建立于 2020 四季度，学校程序设计周。

## 内容

设计一款四则运算的自测软件，可用于小学生的四则运算训练。

在线预览 (GitHub Pages)：<https://github.amzrk2.cc/pouni-calculation-tester/>

### 基本思路

React (with Hooks)。设置页面根据设置进行题目生成后，将结果于题目存于 store 中。做题完成后进行比对，结果保存至 store 同时于 localStorage 进行同步，提供结果下载。

### 设计细节

#### 表达式生成

构建一个 `ExpGen` 类，类存放表达式生成相关的设置属性，再根据属性（初始化或更新）来生成一定数量的表达式。

生成的核心是一个随机数生成函数，由规定范围的随机数来决定运算数、小数和负数、是否插入括号和括号位置。在生成完成后，需要检查结果是否也符合用户的设置，如小数、负数等。

表达式是一个普通对象，包含两个属性：算式和答案。

#### 括号插入

表达式生成中重要的一步为括号插入。括号插入的核心即前文所提到的随机数生成函数，以下为括号插入流程：

1. 检查元素个数，元素 `<=3` 的表达式直接排除
2. 随机数生成第一个位置（符号后）
3. 随机数生成第二个位置（符号前）
4. 检查是否在同一个运算数两侧，若是则重新测试
5. 确认无误后进行插入

#### 题目生成

题目生成即根据前文生成的源表达式生成题目的方法：

- 对于填空题，无需多加配置，完成数据结构即可
- 对于判断题，依靠随机数生成函数将随机题目的随机答案打乱为错误答案
- 对于选择题，依靠随机数生成函数随机生成三个错误的选项

#### 题目展示页

由于在数据量大的情况下有略微的可能导致题目生成减慢，为了不阻塞 DOM 更新，将生成表达式与题目的函数定义为返回 Promise，并且在题目页面的 `useEffect` 钩子内调用，并且提供 `loading` 指示器。

#### 历史记录的增删改查

完成一次测试后对题目进行判题，并保存入历史记录。历史记录可以使用 `mongoose` 连接远程 MongoDB 数据库实现，这里只是简单的写入 `store`，并且依靠浏览器的 `localStorage` 将数据持久化。

增加和删除记录的关键点是记录 ID 的生成，为了防止记录混乱，每次生成记录时我们只取当前数据中的最大 ID 加 1 而不复用空闲的 ID，在删除记录时也根据 ID 进行删除。

除了 `localStorage` 之外，还提供了 JSON 格式数据导出的功能，实现了自定义的文件商城与下载处理类。下载通过隐藏的 HTML5 download 元素，上传使用了 Reader。

#### 细节处理

在用户友好方便进行了细节的处理：

- 提交后自动跳转至对应历史记录
- 删除当前历史记录后自动跳转回列表
- 404 页面首页跳转
- 为了避免做到途中的题目数据被删除，修改生成设置后需要在右侧控制栏手动拉取新生成的题目

## 开发

### `npm start`

在 [http://localhost:3000](http://localhost:3000) 运行开发服务器。

### `npm run build`

将项目编译至 `build` 文件夹。

## LICENSE

The project is released under the `Apache License 2.0`, for more information read the [LICENSE](https://github.com/amzrk2/pouni-calculation-tester/blob/main/LICENSE).

> Copyright © 2020 DSRKafuU(NJUPTB18030620) <https://amzrk2.cc/>
